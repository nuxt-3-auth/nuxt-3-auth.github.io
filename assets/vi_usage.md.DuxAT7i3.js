import{_ as s,c as t,o as n,a4 as e}from"./chunks/framework.CfbOou38.js";const u=JSON.parse('{"title":"Usage","description":"","frontmatter":{},"headers":[],"relativePath":"vi/usage.md","filePath":"vi/usage.md"}'),i={name:"vi/usage.md"},a=e(`<h1 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;Usage&quot;">​</a></h1><h2 id="authen-tren-pages" tabindex="-1">Authen trên pages <a class="header-anchor" href="#authen-tren-pages" aria-label="Permalink to &quot;Authen trên pages&quot;">​</a></h2><p>Để yêu cầu đăng nhập cho một trang bất kỳ, bạn chỉ cần khai báo page meta <code>auth</code> cho trang đó bằng cách sử dụng hàm <code>definePageMeta</code>:</p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // pages/admin.vue</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  definePageMeta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ auth: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>Như vậy, khi truy cập vào trang <code>/admin</code>, nếu chưa đăng nhập, bạn sẽ được chuyển hướng đến trang <code>/login</code>. Sau khi đăng nhập thành công, bạn sẽ được chuyển hướng lại trang <code>/admin</code>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Xem thêm về meta <code>auth</code> tại <a href="/vi/guide/middleware.html#middleware">Middleware</a>.</p><p>Xem thêm thông tin hướng dẫn về login tại mục <a href="/vi/guide/login.html">Guide &gt; Login</a> và logout tại mục <a href="/vi/guide/logout.html">Guide &gt; Logout</a>.</p></div><h2 id="authen-tren-api-calls" tabindex="-1">Authen trên API calls <a class="header-anchor" href="#authen-tren-api-calls" aria-label="Permalink to &quot;Authen trên API calls&quot;">​</a></h2><p>Một khi đã đăng nhập thành công, module sẽ tự động gắn access token vào header của mọi request API (nếu token tồn tại), bạn không cần phải thực hiện thêm bất cứ thao tác nào.</p><p>Trong một số trường hợp, bạn có thể sẽ muốn gọi API mà không đính kèm access token vào header, trong trường hợp này bạn có thể truyền vào option <code>auth: false</code> khi thực hiện gọi API như sau:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  auth: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>Option <code>auth</code> nhận các giá trị sau:</p><table tabindex="0"><thead><tr><th>Giá trị</th><th>Mô tả</th><th>Tự động kèm Access token trong headers</th><th>Tự động refresh token</th></tr></thead><tbody><tr><td><code>true</code></td><td>Dùng cho những API requests yêu cầu <strong>phải đăng nhập</strong>.<br>Access token (nếu có) sẽ được đính kèm vào request header, nếu request bị lỗi <code>401 Unauthorized</code>, module sẽ tự động thực hiện refresh token và thử lại request 1 lần, nếu vẫn bị lỗi <code>401 Unauthorized</code> lần thứ 2, module sẽ tự động chuyển hướng đến trang <code>/login</code>.</td><td><div style="text-align:center;">✅</div></td><td><div style="text-align:center;">✅</div></td></tr><tr><td><code>false</code></td><td>Dùng cho những API requests yêu cầu <strong>KHÔNG đăng nhập</strong>.<br><strong>Access token dù tồn tại cũng sẽ không được đính kèm vào request header</strong> khi thực hiện request. Do đó, nếu request bị lỗi <code>401 Unauthorized</code>, module sẽ <strong>không thực hiện refresh token</strong> mà chuyển hướng đến trang <code>/login</code> ngay lập tức.</td><td><div style="text-align:center;">❌</div></td><td><div style="text-align:center;">❌</div></td></tr><tr><td><code>&#39;optional&#39;</code></td><td>Dùng cho những API requests <strong>có hoặc không</strong> yêu cầu phải đăng nhập.<br>Access token (nếu có) sẽ được đính kèm vào request header, tuy nhiên nếu request bị lỗi <code>401 Unauthorized</code>, module sẽ <strong>không thực hiện refresh token</strong> mà chuyển hướng đến trang <code>/login</code> ngay lập tức.</td><td><div style="text-align:center;">✅</div></td><td><div style="text-align:center;">❌</div></td></tr></tbody></table><h2 id="interception-va-refresh-token" tabindex="-1">Interception và refresh token <a class="header-anchor" href="#interception-va-refresh-token" aria-label="Permalink to &quot;Interception và refresh token&quot;">​</a></h2><p>Mặc định, module sẽ tự động thực hiện refresh token khi gọi API và nhận được response lỗi <code>401 Unauthorized</code>.</p><p>Trong trường hợp bạn muốn chủ động refresh access token, bạn có thể gọi hàm <code>refreshTokens</code> của <code>$auth</code> như sau:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useNuxtApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $auth.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refreshTokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // handle error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Lưu ý rằng trong trường hợp refresh token không thành công, hàm <code>refreshTokens</code> sẽ gọi <code>logout(false)</code> và trả về một object lỗi, bạn cần phải catch lỗi này.</p>`,17),h=[a];function l(r,d,c,o,p,g){return n(),t("div",null,h)}const E=s(i,[["render",l]]);export{u as __pageData,E as default};
